window.__require=function t(e,n,i){function s(r,a){if(!n[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var h="function"==typeof __require&&__require;if(!a&&h)return h(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+r+"'")}}var u=n[r]={exports:{}};e[r][0].call(u.exports,function(t){return s(e[r][1][t]||t)},u,u.exports,t,e,n,i)}return n[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<i.length;r++)s(i[r]);return s}({1:[function(t,e,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function s(t){return"function"==typeof t}function o(t){return"number"==typeof t}function r(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!o(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,n,i,o,c,h;if(this._events||(this._events={}),"error"===t&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}if(a(n=this._events[t]))return!1;if(s(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(r(n))for(o=Array.prototype.slice.call(arguments,1),i=(h=n.slice()).length,c=0;c<i;c++)h[c].apply(this,o);return!0},i.prototype.addListener=function(t,e){var n;if(!s(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,s(e.listener)?e.listener:e),this._events[t]?r(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,r(this._events[t])&&!this._events[t].warned&&(n=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){if(!s(e))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var n,i,o,a;if(!s(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(o=(n=this._events[t]).length,i=-1,n===e||s(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(r(n)){for(a=o;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(s(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?s(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(s(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,n){(function(t,i){"object"==typeof n&&"object"==typeof e?e.exports=i():"function"==typeof define&&define.amd?define("StateMachine",[],i):"object"==typeof n?n.StateMachine=i():t.StateMachine=i()})(this,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){"use strict";t.exports=function(t,e){var n,i,s;for(n=1;n<arguments.length;n++)for(s in i=arguments[n])i.hasOwnProperty(s)&&(t[s]=i[s]);return t}},function(t,e,n){"use strict";var i=n(0);t.exports={build:function(t,e){var n,s,o,r=e.plugins;for(n=0,s=r.length;n<s;n++)(o=r[n]).methods&&i(t,o.methods),o.properties&&Object.defineProperties(t,o.properties)},hook:function(t,e,n){var i,s,o,r,a=t.config.plugins,c=[t.context];for(n&&(c=c.concat(n)),i=0,s=a.length;i<s;i++)r=a[i],(o=a[i][e])&&o.apply(r,c)}}},function(t,e,n){"use strict";function i(t){if(0===t.length)return t;var e,n,i=t.split(/[_-]/);if(1===i.length&&i[0][0].toLowerCase()===i[0][0])return t;for(n=i[0].toLowerCase(),e=1;e<i.length;e++)n=n+i[e].charAt(0).toUpperCase()+i[e].substring(1).toLowerCase();return n}i.prepended=function(t,e){return t+(e=i(e))[0].toUpperCase()+e.substring(1)},t.exports=i},function(t,e,n){"use strict";var i=n(0),s=n(2);function o(t,e){t=t||{},this.options=t,this.defaults=e.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(t.init),this.data=this.configureData(t.data),this.methods=this.configureMethods(t.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(t.transitions||[]),this.plugins=this.configurePlugins(t.plugins,e.plugin)}i(o.prototype,{addState:function(t){this.map[t]||(this.states.push(t),this.addStateLifecycleNames(t),this.map[t]={})},addStateLifecycleNames:function(t){this.lifecycle.onEnter[t]=s.prepended("onEnter",t),this.lifecycle.onLeave[t]=s.prepended("onLeave",t),this.lifecycle.on[t]=s.prepended("on",t)},addTransition:function(t){this.transitions.indexOf(t)<0&&(this.transitions.push(t),this.addTransitionLifecycleNames(t))},addTransitionLifecycleNames:function(t){this.lifecycle.onBefore[t]=s.prepended("onBefore",t),this.lifecycle.onAfter[t]=s.prepended("onAfter",t),this.lifecycle.on[t]=s.prepended("on",t)},mapTransition:function(t){var e=t.name,n=t.from,i=t.to;return this.addState(n),"function"!=typeof i&&this.addState(i),this.addTransition(e),this.map[n][e]=t,t},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(t){return"string"==typeof t?this.mapTransition(i({},this.defaults.init,{to:t,active:!0})):"object"==typeof t?this.mapTransition(i({},this.defaults.init,t,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(t){return"function"==typeof t?t:"object"==typeof t?function(){return t}:function(){return{}}},configureMethods:function(t){return t||{}},configurePlugins:function(t,e){var n,i,s;for(n=0,i=(t=t||[]).length;n<i;n++)"function"==typeof(s=t[n])&&(t[n]=s=s()),s.configure&&s.configure(this);return t},configureTransitions:function(t){var e,n,i,s,o,r=this.defaults.wildcard;for(n=0;n<t.length;n++)for(i=t[n],s=Array.isArray(i.from)?i.from:[i.from||r],o=i.to||r,e=0;e<s.length;e++)this.mapTransition({name:i.name,from:s[e],to:o})},transitionFor:function(t,e){var n=this.defaults.wildcard;return this.map[t][e]||this.map[n][e]},transitionsFor:function(t){var e=this.defaults.wildcard;return Object.keys(this.map[t]).concat(Object.keys(this.map[e]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),t.exports=o},function(t,e,n){var i=n(0),s=n(6),o=n(1),r=[null,[]];function a(t,e){this.context=t,this.config=e,this.state=e.init.from,this.observers=[t]}i(a.prototype,{init:function(t){if(i(this.context,this.config.data.apply(this.context,t)),o.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(t){return Array.isArray(t)?t.indexOf(this.state)>=0:this.state===t},isPending:function(){return this.pending},can:function(t){return!this.isPending()&&!!this.seek(t)},cannot:function(t){return!this.can(t)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(t,e){var n=this.config.defaults.wildcard,i=this.config.transitionFor(this.state,t),s=i&&i.to;return"function"==typeof s?s.apply(this.context,e):s===n?this.state:s},fire:function(t,e){return this.transit(t,this.state,this.seek(t,e),e)},transit:function(t,e,n,i){var s=this.config.lifecycle,o=this.config.options.observeUnchangedState||e!==n;return n?this.isPending()?this.context.onPendingTransition(t,e,n):(this.config.addState(n),this.beginTransit(),i.unshift({transition:t,from:e,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(s.onBefore.transition),this.observersForEvent(s.onBefore[t]),o?this.observersForEvent(s.onLeave.state):r,o?this.observersForEvent(s.onLeave[e]):r,this.observersForEvent(s.on.transition),o?["doTransit",[this]]:r,o?this.observersForEvent(s.onEnter.state):r,o?this.observersForEvent(s.onEnter[n]):r,o?this.observersForEvent(s.on[n]):r,this.observersForEvent(s.onAfter.transition),this.observersForEvent(s.onAfter[t]),this.observersForEvent(s.on[t])],i)):this.context.onInvalidTransition(t,e,n)},beginTransit:function(){this.pending=!0},endTransit:function(t){return this.pending=!1,t},failTransit:function(t){throw this.pending=!1,t},doTransit:function(t){this.state=t.to},observe:function(t){if(2===t.length){var e={};e[t[0]]=t[1],this.observers.push(e)}else this.observers.push(t[0])},observersForEvent:function(t){for(var e,n=0,i=this.observers.length,s=[];n<i;n++)(e=this.observers[n])[t]&&s.push(e);return[t,s,!0]},observeEvents:function(t,e,n,i){if(0===t.length)return this.endTransit(void 0===i||i);var s=t[0][0],r=t[0][1],a=t[0][2];if(e[0].event=s,s&&a&&s!==n&&o.hook(this,"lifecycle",e),0===r.length)return t.shift(),this.observeEvents(t,e,s,i);var c=r.shift(),h=c[s].apply(c,e);return h&&"function"==typeof h.then?h.then(this.observeEvents.bind(this,t,e,s)).catch(this.failTransit.bind(this)):!1===h?this.endTransit(!1):this.observeEvents(t,e,s,h)},onInvalidTransition:function(t,e,n){throw new s("transition is invalid in current state",t,e,n,this.state)},onPendingTransition:function(t,e,n){throw new s("transition is invalid while previous transition is still in progress",t,e,n,this.state)}}),t.exports=a},function(t,e,n){"use strict";var i=n(0),s=n(2),o=n(1),r=n(3),a=n(4),c={is:function(t){return this._fsm.is(t)},can:function(t){return this._fsm.can(t)},cannot:function(t){return this._fsm.cannot(t)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(t,e,n){return this._fsm.onInvalidTransition(t,e,n)},onPendingTransition:function(t,e,n){return this._fsm.onPendingTransition(t,e,n)}},h={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(t){throw Error("use transitions to change state")}}};function u(t){return l(this||{},t)}function l(t,e){return p(t,new r(e,u)),t._fsm(),t}function p(t,e){if("object"!=typeof t||Array.isArray(t))throw Error("StateMachine can only be applied to objects");o.build(t,e),Object.defineProperties(t,h),i(t,c),i(t,e.methods),e.allTransitions().forEach(function(e){t[s(e)]=function(){return this._fsm.fire(e,[].slice.call(arguments))}}),t._fsm=function(){this._fsm=new a(this,e),this._fsm.init(arguments)}}u.version="3.0.1",u.factory=function(){var t,e;"function"==typeof arguments[0]?(t=arguments[0],e=arguments[1]||{}):(t=function(){this._fsm.apply(this,arguments)},e=arguments[0]||{});var n=new r(e,u);return p(t.prototype,n),t.prototype._fsm.config=n,t},u.apply=l,u.defaults={wildcard:"*",init:{name:"init",from:"none"}},t.exports=u},function(t,e,n){"use strict";t.exports=function(t,e,n,i,s){this.message=t,this.transition=e,this.from=n,this.to=i,this.current=s}}])})},{}],Base:[function(t,e,n){"use strict";cc._RF.push(e,"ebde7hi5NBIlowoLUvneYGG","Base");var i=t("MainEmitter"),s=t("EventCode").GAME_EVENTS,o=t("EventEmitter"),r=t("Key");cc.Class({extends:cc.Component,properties:{healthBar:cc.ProgressBar,maxHealth:50,curHealth:0,explosionSound:{default:null,type:cc.AudioClip}},onLoad:function(){this.curHealth=this.maxHealth,i.instance.registerEvent(s.HIT_BASE,this.onHitBase.bind(this))},onHitBase:function(t){this.curHealth-=t,this.healthBar.progress=this.curHealth/this.maxHealth,this.curHealth<=0&&(o.instance.emit(r.PLAY_SFX,this.explosionSound),this.node.getChildByName("Base Explosion").active=!0,this.healthBar.active=!1,i.instance.emit(s.END_GAME),this.node.getChildByName("Sprite").color=cc.Color.GRAY)}}),cc._RF.pop()},{EventCode:"EventCode",EventEmitter:"EventEmitter",Key:"Key",MainEmitter:"MainEmitter"}],Bullet:[function(t,e,n){"use strict";cc._RF.push(e,"2d759sq75lOx4l/vUtraiZD","Bullet"),cc.Class({extends:cc.Component,properties:{speed:20,damage:0},update:function(t){this.node.x+=this.velocity.x,this.node.y+=this.velocity.y},configBullet:function(t){this.damage=t.damage,this.getComponent(cc.Sprite).spriteFrame=t.spriteFrame,this.node.width=t.size.width,this.node.height=t.size.height},setVelocity:function(){var t=(this.node.angle-180)*(Math.PI/180)-Math.PI/2;this.velocity=cc.v2(Math.cos(t)*this.speed,Math.sin(t)*this.speed)},onCollisionEnter:function(t,e){"enemy"===t.node.group&&(this.node.destroy(),t.node.getComponent("Enemy").takeDamage(this.damage))}}),cc._RF.pop()},{}],EnemyWaves:[function(t,e,n){"use strict";cc._RF.push(e,"98a775zeI9FH4lkMC/tsSZk","EnemyWaves");var i=t("MainEmitter"),s=t("EventCode").UI_EVENTS,o=t("WaveData");cc.Class({extends:cc.Component,properties:{wave:{default:null,type:o}},init:function(t){this.waveIndex=0,this.enemyCount=0,this.isBoss=!1,this.bossCreated=0,this.level=t,this.items=[],this.createWave()},createWave:function(){var t=this,e=this.wave;i.instance.emit(s.CREATE_WAVE),++this.waveIndex;var n=0;1===this.waveIndex?this.enemiesCount=5:2===this.waveIndex?this.enemiesCount=10:this.enemiesCount++,this.schedule(function(){i.instance.emit(s.UPDATE_WAVE_COUNT,t.waveIndex),t.createEnemy(e.enemies,t.waveIndex,n),n++},e.repeatInterval,this.enemiesCount-1,e.timeout)},createEnemy:function(t,e,n){var i=this,s=this.enemiesCount-1;5===e&&n===s||10===e&&n===s?(this.isBoss=!0,this.bossCreated++):this.isBoss=!1;var o=t[this.isBoss?2:Math.floor(Math.random()*(t.length-1))],r=cc.instantiate(o);this.node.addChild(r);var a=r.getComponent("Enemy");this.isBoss?(5===e&&(a.health=1500,a.coins=500),10===e&&(a.health=3e3,a.coins=1e3)):(a.health=a.health*e,a.coins=a.coins*e),a.init(this.level),this.items.push(a),r.once("killed",function(){i.onEnemyRemoved("enemy-killed",a)},this),r.once("finished",function(){i.onEnemyRemoved("enemy-finished",a)},this)},onEnemyRemoved:function(t,e){this.node.emit(t,e),this.items=this.items.filter(function(t){return t!==e}),this.items.length||this.createWave()}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter",WaveData:"WaveData"}],Enemy:[function(t,e,n){"use strict";cc._RF.push(e,"67ed0+CLJJM8oTR1Qg4EHKL","Enemy");var i=t("MainEmitter"),s=t("EventCode").GAME_EVENTS;cc.Class({extends:cc.Component,properties:{velocity:{default:150,serializable:!0},health:50,damage:{default:10,serializable:!0},coins:{default:10,serializable:!0},_rotationSpeed:300},init:function(t){this.levelMap=t.map},start:function(){this.targets=this.levelMap.tiledMap.getObjectGroup("path").getObjects(),this.targetIndex=1,this.node.setPosition(this.getCurrentTargetPosition()),this.targetIndex++,this.move()},move:function(){var t=this,e=this.getCurrentTargetPosition();e?(this.rotateTo(e),this.moveTo(e).then(function(){t.targetIndex++,t.move()})):(this.node.emit("finished"),this.node.destroy())},getAngle:function(t){return-180*Math.atan2(t.y-this.node.y,t.x-this.node.x)/Math.PI},rotateTo:function(t){var e=this.getAngle(t),n=Math.abs(e-this.node.angle);if(n){var i=n/this._rotationSpeed;this.node.runAction(cc.rotateTo(i,e))}},moveTo:function(t){var e=this,n=Math.abs(t.x-this.node.x),i=Math.abs(t.y-this.node.y),s=Math.max(n,i)/this.velocity;return new Promise(function(n){var i=cc.moveTo(s,t),o=cc.sequence(i,cc.callFunc(n));e.node.runAction(o)})},getCurrentTarget:function(){var t=this;return this.targets.find(function(e){return parseInt(e.name)===t.targetIndex})},getCurrentTargetPosition:function(){var t=this.getCurrentTarget();if(!t)return!1;var e=this.levelMap.getTileCoordinatesByPosition(cc.v2(t.x,t.y)),n=this.levelMap.roadsLayer.getPositionAt(e.x,e.y);return cc.v2(n.x+this.levelMap.tileWidth/2,n.y+this.levelMap.tileWidth/2)},takeDamage:function(t){this.health-=t,this.health<=0&&(this.node.stopAllActions(),this.node.emit("killed"),i.instance.emit(s.ENEMY_KILLED,this.coins),this.node.destroy())},onCollisionEnter:function(t,e){"base"===t.node.group&&i.instance.emit(s.HIT_BASE,this.damage)}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],EventCode:[function(t,e,n){"use strict";cc._RF.push(e,"e9a79QGzPxLvoy/FeaKrFnw","EventCode");e.exports={GAME_EVENTS:{ENEMY_KILLED:"enemy-killed",HIT_BASE:"hit-base",END_GAME:"end-game",INSTANTIATE_TOWER:"instantiate-tower",REQUEST_BUY_TOWER:"request-buy-tower",CREATE_TOWER:"create-tower",SELL_TOWER:"sell-tower",REQUEST_UPGRADE_TOWER:"request-upgrade-tower",UPGRADE_TOWER:"upgrade-tower"},UI_EVENTS:{CREATE_WAVE:"create-wave",UPDATE_WAVE_COUNT:"update-wave-count",UPDATE_COINS_AMOUNT:"update-coins-amount"},SOUND_EVENTS:{TOWER_SHOOT:"tower-shoot"}},cc._RF.pop()},{}],EventEmitter:[function(t,e,n){"use strict";cc._RF.push(e,"10a70sUlt9ExKMIdskC12bD","EventEmitter");var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=t("events"),r=function(){function t(){s(this,t),this._emitter=new o,this._emitter.setMaxListeners(100)}return i(t,[{key:"emit",value:function(){var t;(t=this._emitter).emit.apply(t,arguments)}},{key:"registerEvent",value:function(t,e){this._emitter.on(t,e)}},{key:"registerOnce",value:function(t,e){this._emitter.once(t,e)}},{key:"removeEvent",value:function(t,e){this._emitter.removeListener(t,e)}},{key:"destroy",value:function(){this._emitter.removeAllListeners(),this._emitter=null,t.instance=null}}]),t}();r.instance=null,e.exports=r,cc._RF.pop()},{events:1}],GameManager:[function(t,e,n){"use strict";cc._RF.push(e,"a9b0a+VCK1BmopdGjoOVBXC","GameManager");var i=t("javascript-state-machine"),s=t("../Utilities/EventEmitter"),o=t("Key"),r="init",a="start",c="wave_complete",h="game_over";cc.Class({extends:cc.Component,properties:{HP:t("Base"),mSounds:{type:cc.AudioClip,default:[]}},onLoad:function(){var t=this;s.instance.registerEvent(o.SEND_DATA,function(e){cc.log(e),s.instance.emit(o.PLAY_MUSIC,t.mSounds[0])}.bind(this)),this._onStartGame=this.onStartGame.bind(this),this._onCompleteGame=this.onCompleteGame.bind(this),this._onGameOver=this.onGameOver.bind(this),this.fsm=new i({init:r,transitions:[{name:"goStart",from:r,to:a},{name:"goComplete",from:a,to:c},{name:"goOver",from:a,to:h}],methods:{onGoStart:this._onStartGame,onGoComplete:this._onCompleteGame,onGoOver:this._onGameOver}})},start:function(){var t=this;this.schedule(function(){t.HP.curHealth>0?cc.log("playing"):(cc.log("end Game"),t.unscheduleAllCallbacks())},1)},onStartGame:function(){cc.log("start game")},onCompleteGame:function(){cc.log("complete wave")},onGameOver:function(){cc.log("game over")}}),cc._RF.pop()},{"../Utilities/EventEmitter":void 0,Base:"Base",Key:"Key","javascript-state-machine":2}],Key:[function(t,e,n){"use strict";cc._RF.push(e,"808f59yllREH60d0xBqyZqK","Key"),e.exports={POPUP_SHOW:"popupShow",POPUP_HIDE:"popupHide",PLAY_MUSIC:"playMusic",PLAY_SFX:"playSfx",CHANGE_SFX_VOLUME:"changeSfxVolume",CHANGE_MUSIC_VOLUME:"changeMusicVolume"},cc._RF.pop()},{}],LevelMap:[function(t,e,n){"use strict";cc._RF.push(e,"f398fUyZupLRIR9cy11+aqb","LevelMap"),cc.Class({extends:cc.Component,properties:{},init:function(){this.tiledMap=this.getComponent(cc.TiledMap),this.roadsLayer=this.tiledMap.getLayer("roads"),this.towersLayer=this.tiledMap.getLayer("towers"),this.tiledSize=this.tiledMap.getTileSize(),this.tileWidth=this.tiledSize.width,this.tileHeight=this.tiledSize.height,this.mapSize=this.tiledMap.getMapSize(),this.mapWidth=this.mapSize.width,this.mapHeight=this.mapSize.height},getTileCoordinatesByPosition:function(t){return{x:Math.floor(t.x/this.tileWidth),y:this.mapHeight-Math.floor(t.y/this.tileHeight)-1}}}),cc._RF.pop()},{}],Level:[function(t,e,n){"use strict";cc._RF.push(e,"04980rEz+hDLZ3jKOiUixFM","Level");var i=t("MainEmitter"),s=t("EventCode"),o=s.GAME_EVENTS,r=s.UI_EVENTS,a=t("LevelMap"),c=t("PanelCreate"),h=t("Towers"),u=t("PanelUpgrade"),l=t("EnemyWaves");cc.Class({extends:cc.Component,properties:{map:{default:null,type:a},panelCreate:{default:null,type:c},panelUpgrade:{default:null,type:u},towers:{default:null,type:h},enemyWaves:{default:null,type:l}},onLoad:function(){this.coins=60,this.init(),this.setEvents()},start:function(){i.instance.emit(r.UPDATE_COINS_AMOUNT,this.coins)},init:function(){cc.director.getCollisionManager().enabled=!0,this.map.init(),this.panelCreate.init(this.map),this.panelUpgrade.init(this.map),this.towers.init(this.map),this.enemyWaves.init(this)},setEvents:function(){this.map.node.on("touchend",this.onMapTouch,this),i.instance.registerEvent(o.REQUEST_BUY_TOWER,this.onRequestBuyTower.bind(this)),i.instance.registerEvent(o.ENEMY_KILLED,this.updateCoinsAmount.bind(this)),i.instance.registerEvent(o.SELL_TOWER,this.updateCoinsAmount.bind(this)),i.instance.registerEvent(o.REQUEST_UPGRADE_TOWER,this.onRequestUpgradeTower.bind(this))},onMapTouch:function(t){this.panelCreate.hide(),this.panelUpgrade.hide();var e=t.getLocation(),n={x:2*e.x,y:2*e.y},i=this.map.getTileCoordinatesByPosition(n);if(this.map.towersLayer.getTileGIDAt(i)){var s=this.towers.getByCoordinates(i);s?this.panelUpgrade.show(i,s):this.panelCreate.show(i)}},onRequestBuyTower:function(t){this.coins>=t?(i.instance.emit(o.CREATE_TOWER),this.updateCoinsAmount(-t)):console.log("Not enough coins to buy tower!"),this.panelCreate.hide()},onRequestUpgradeTower:function(t){this.coins>=t.upgradePrice?(t.upgradeTower(),this.updateCoinsAmount(-t.upgradePrice)):console.log("Not enough coins to upgrade tower!"),this.panelUpgrade.hide()},updateCoinsAmount:function(t){this.coins+=t,i.instance.emit(r.UPDATE_COINS_AMOUNT,this.coins)}}),cc._RF.pop()},{EnemyWaves:"EnemyWaves",EventCode:"EventCode",LevelMap:"LevelMap",MainEmitter:"MainEmitter",PanelCreate:"PanelCreate",PanelUpgrade:"PanelUpgrade",Towers:"Towers"}],MainEmitter:[function(t,e,n){"use strict";cc._RF.push(e,"9cba0opxORCvpkLRvxPMkQU","MainEmitter");var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=t("events"),r=function(){function t(){s(this,t),this._emiter=new o,this._emiter.setMaxListeners(100)}return i(t,[{key:"getInstance",value:function(){return t.instance||(t.instance=new t),t.instance}},{key:"emit",value:function(){var t;(t=this._emiter).emit.apply(t,arguments)}},{key:"registerEvent",value:function(t,e){this._emiter.on(t,e)}},{key:"registerOnce",value:function(t,e){this._emiter.once(t,e)}},{key:"removeEvent",value:function(t,e){this._emiter.removeListener(t,e)}},{key:"destroy",value:function(){this._emiter.removeAllListeners(),this._emiter=null,t.instance=null}}]),t}();r.instance=new r,e.exports=r,cc._RF.pop()},{events:1}],MenuManager:[function(t,e,n){"use strict";cc._RF.push(e,"052144YkiVE3qs/fTutm9+p","MenuManager");var i=t("EventEmitter"),s=t("Key"),o=t("SettingController");cc.Class({extends:cc.Component,properties:{mButton:[cc.Button],mainMenu:cc.Node,settingPopup:cc.Node,mMenuMusic:{type:cc.AudioClip,default:null}},start:function(){i.instance.emit(s.PLAY_MUSIC,this.mMenuMusic)},onStartGame:function(){cc.director.loadScene("Game",function(){cc.log(o),i.instance.emit(s.SEND_DATA,o)})},onSetting:function(){i.instance.emit(s.POPUP_SHOW,this.settingPopup),this.mButton.forEach(function(t){t.interactable=!1})},onBackMenu:function(){i.instance.emit(s.POPUP_HIDE,this.settingPopup),this.mButton.forEach(function(t){t.interactable=!0})}}),cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key",SettingController:"SettingController"}],PanelCreate:[function(t,e,n){"use strict";cc._RF.push(e,"57748c2zQpCFpRbi469wSkI","PanelCreate");var i=t("MainEmitter"),s=t("EventCode").GAME_EVENTS;cc.Class({extends:cc.Component,properties:{panel1:cc.Node,panel2:cc.Node},init:function(t){this.map=t,this.coordinates={x:0,y:0},this.panel1.on("touchend",this.onPanelClick,this),this.panel2.on("touchend",this.onPanelClick,this)},show:function(t){this.coordinates=t;var e=this.map.towersLayer.getPositionAt(this.coordinates);this.node.setPosition(cc.v2(e.x+this.map.tileWidth/2,e.y+this.map.tileHeight/2)),this.node.active=!0},hide:function(){this.node.active=!1},onPanelClick:function(t){i.instance.emit(s.INSTANTIATE_TOWER,{towerKey:t.target.name,towerCoordinates:this.coordinates})}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],PanelUpgrade:[function(t,e,n){"use strict";cc._RF.push(e,"bf72ccFHBtMv56dPM5YGEyZ","PanelUpgrade");var i=t("MainEmitter"),s=t("EventCode").GAME_EVENTS;cc.Class({extends:cc.Component,properties:{upgradeBtn:cc.Node,sellBtn:cc.Node},init:function(t){this.map=t,this.coordinates={x:0,y:0},this.towerComponent=null,this.upgradeBtn.on("touchend",this.onUpgradeTower,this),this.sellBtn.on("touchend",this.onSellTower,this)},show:function(t,e){this.towerComponent=e,this.coordinates=t;var n=this.map.towersLayer.getPositionAt(this.coordinates);this.node.setPosition(cc.v2(n.x+this.map.tileWidth/2,n.y+this.map.tileHeight/2)),this.node.active=!0},hide:function(){this.node.active=!1},onUpgradeTower:function(){i.instance.emit(s.REQUEST_UPGRADE_TOWER,this.towerComponent),this.hide()},onSellTower:function(){var t=Math.trunc(this.towerComponent.price/2);i.instance.emit(s.SELL_TOWER,t),i.instance.emit(s.DESTROY_TOWER,this.towerComponent),this.hide()}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],PopupSystem:[function(t,e,n){"use strict";cc._RF.push(e,"b9da43kubFIxY4QpXD/uyDe","PopupSystem");var i=t("EventEmitter"),s=t("Key");cc.Class({extends:cc.Component,properties:{},onLoad:function(){i.instance.registerEvent(s.POPUP_SHOW,this.popupShow.bind(this)),i.instance.registerEvent(s.POPUP_HIDE,this.popupHide.bind(this))},popupShow:function(t){t.active=!0},popupHide:function(t){t.active=!1}}),cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key"}],SettingController:[function(t,e,n){"use strict";cc._RF.push(e,"f6dfai4LbhH+IgqhT9mSlbR","SettingController");var i=t("EventEmitter"),s=t("Key"),o={sfxVolume:0,musicVolume:0,mouseSpeed:0};cc.Class({extends:cc.Component,properties:{sfxVolumeSlider:cc.Slider,musicVolumeSlider:cc.Slider},ChangeSfxVolume:function(){i.instance.emit(s.CHANGE_SFX_VOLUME,this.sfxVolumeSlider.progress),o.sfxVolume=this.sfxVolumeSlider.progress},ChangeMusicVolume:function(){i.instance.emit(s.CHANGE_MUSIC_VOLUME,this.musicVolumeSlider.progress),o.musicVolume=this.musicVolumeSlider.progress}}),e.exports=o,cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key"}],SingleTon:[function(t,e,n){"use strict";cc._RF.push(e,"b91ddA37klL74rfFkCcWAvf","SingleTon");var i=t("EventEmitter");cc.Class({extends:cc.Component,properties:{},onLoad:function(){i.instance=new i}}),cc._RF.pop()},{EventEmitter:"EventEmitter"}],SoundManager:[function(t,e,n){"use strict";cc._RF.push(e,"73fbfUcnI9IHooXEbci6gSm","SoundManager");var i=t("MainEmitter"),s=t("EventCode").SOUND_EVENTS;cc.Class({extends:cc.Component,properties:{tower1Sound:{default:null,type:cc.AudioClip}},onLoad:function(){i.instance.registerEvent(s.TOWER_SHOOT,this.playTowerShootSound.bind(this))},start:function(){},playTowerShootSound:function(){cc.audioEngine.playEffect(this.tower1Sound,!1)}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],SoundSystem:[function(t,e,n){"use strict";cc._RF.push(e,"ff7f7OpPuJLK6uOq4d16tlU","SoundSystem");var i=t("EventEmitter"),s=t("Key");cc.Class({extends:cc.Component,properties:{mMusicSound:cc.AudioSource,mSfxSound:cc.AudioSource},onLoad:function(){i.instance.registerEvent(s.PLAY_MUSIC,this.playMusic.bind(this)),i.instance.registerEvent(s.PLAY_SFX,this.playSfx.bind(this)),i.instance.registerEvent(s.CHANGE_SFX_VOLUME,this.changeSfxVolume.bind(this)),i.instance.registerEvent(s.CHANGE_MUSIC_VOLUME,this.changeMusicVolume.bind(this))},playMusic:function(t){this.mMusicSound.clip=t,this.mMusicSound.play()},playSfx:function(t){this.mSfxSound.clip=t,this.mSfxSound.play()},changeSfxVolume:function(t){this.mSfxSound.volume=t},changeMusicVolume:function(t){this.mMusicSound.volume=t}}),cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key"}],TowersData:[function(t,e,n){"use strict";cc._RF.push(e,"a4615+Hvp1MGIfzJVsS8I1V","TowersData");e.exports={TOWER_1_DATA:[{type:"Tower1",level:1,damage:25,reloadTime:1,price:60,upgradePrice:100,attackRange:0,bulletSpriteFrameIndex:0,bulletSize:{width:20,height:20}},{type:"Tower1",level:2,damage:50,reloadTime:1,price:100,upgradePrice:200,attackRange:0,bulletSpriteFrameIndex:1,bulletSize:{width:30,height:30}},{type:"Tower1",level:3,damage:50,reloadTime:1,price:200,upgradePrice:400,attackRange:0,bulletSpriteFrameIndex:2,bulletSize:{width:30,height:30}},{type:"Tower1",level:4,damage:100,reloadTime:1,price:400,upgradePrice:800,attackRange:0,bulletSpriteFrameIndex:3,bulletSize:{width:30,height:30}},{type:"Tower1",level:5,damage:100,reloadTime:1,price:800,upgradePrice:null,attackRange:0,bulletSpriteFrameIndex:4,bulletSize:{width:30,height:38}}],TOWER_2_DATA:[{type:"Tower2",level:1,damage:20,reloadTime:2,price:60,upgradePrice:100,attackRange:1,bulletSpriteFrameIndex:0,bulletSize:{width:20,height:40}},{type:"Tower2",level:2,damage:40,reloadTime:2,price:100,upgradePrice:200,attackRange:1,bulletSpriteFrameIndex:1,bulletSize:{width:20,height:40}},{type:"Tower2",level:3,damage:40,reloadTime:2,price:200,upgradePrice:400,attackRange:1,bulletSpriteFrameIndex:2,bulletSize:{width:20,height:40}},{type:"Tower2",level:4,damage:80,reloadTime:2,price:400,upgradePrice:800,attackRange:1,bulletSpriteFrameIndex:3,bulletSize:{width:20,height:40}},{type:"Tower2",level:5,damage:80,reloadTime:2,price:800,upgradePrice:null,attackRange:1,bulletSpriteFrameIndex:4,bulletSize:{width:25,height:55}}]},cc._RF.pop()},{}],Towers:[function(t,e,n){"use strict";cc._RF.push(e,"91cafmOETRCQrBiZNYxD7zC","Towers");var i=t("MainEmitter"),s=t("EventCode").GAME_EVENTS;cc.Class({extends:cc.Component,properties:{towerPrefabs:[cc.Prefab]},onLoad:function(){this.curTowerNode=null,i.instance.registerEvent(s.INSTANTIATE_TOWER,this.onInstantiateTower.bind(this)),i.instance.registerEvent(s.CREATE_TOWER,this.onCreateTower.bind(this)),i.instance.registerEvent(s.DESTROY_TOWER,this.onDestroyTower.bind(this))},init:function(t){this.map=t,this.towerComponents=[]},onInstantiateTower:function(t){var e=t.towerKey,n=t.towerCoordinates,o=cc.instantiate(this.towerPrefabs.find(function(t){return t.name===e})),r=o.getComponent("Tower");r.init(n,e);var a=this.map.towersLayer.getPositionAt(n);o.setPosition(cc.v2(a.x+this.map.tileWidth/2,a.y+this.map.tileHeight/2)),this.curTowerNode=o,i.instance.emit(s.REQUEST_BUY_TOWER,r.price)},onCreateTower:function(){var t=this.curTowerNode.getComponent("Tower");this.towerComponents.push(t),this.node.addChild(this.curTowerNode)},onDestroyTower:function(t){this.removeTowerComponent(t)},getByCoordinates:function(t){return this.towerComponents.find(function(e){return e.coordinates.x===t.x&&e.coordinates.y===t.y})},removeTowerComponent:function(t){this.towerComponents=this.towerComponents.filter(function(e){return e.coordinates.x!==t.coordinates.x&&e.coordinates.y!==t.coordinates.y}),t.node.destroy()}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],Tower:[function(t,e,n){"use strict";cc._RF.push(e,"22ce26KkJVM1KaiK8h8hxKE","Tower");var i=t("EventEmitter"),s=t("Key"),o=t("TowersData"),r=o.TOWER_1_DATA,a=o.TOWER_2_DATA;cc.Class({extends:cc.Component,properties:{damage:0,reloadTime:0,attackRange:0,rotationSpeed:2e3,price:0,upgradePrice:0,bulletPrefab:cc.Prefab,bulletSpriteFrames:[cc.SpriteFrame],bulletPosition:cc.Node,shootingSound:{type:cc.AudioClip,default:null}},onLoad:function(){this.timer=0,this.currentEnemy=null},update:function(t){this.currentEnemy&&(this.timer+=t,this.timer>=this.reloadTime&&(this.shoot(),this.timer=0))},init:function(t,e){this.coordinates=t,this.level=1,this.maxLevel=5,this.targets=[],this.type=e,this.towerData="Tower1"===this.type?r:a,this.bulletData={damage:null,spriteFrame:null,size:null},this.configTower()},configTower:function(){var t=this.towerData[this.level-1];this.damage=t.damage,this.reloadTime=t.reloadTime,this.price=t.price,this.attackRange=t.attackRange,this.upgradePrice=t.upgradePrice,this.bulletData.damage=t.damage,this.bulletData.size=t.bulletSize,this.bulletData.spriteFrame=this.bulletSpriteFrames[t.bulletSpriteFrameIndex]},upgradeTower:function(){this.level>=this.maxLevel?console.log("Tower max level"):(this.level++,this.configTower(),console.log("Upgrade tower successfully!",this.level))},onCollisionEnter:function(t,e){"enemy"===t.node.name&&(this.targets.push(t.node),this.currentEnemy=this.getTarget())},onCollisionStay:function(t,e){"enemy"===t.node.name&&this.lookAtEnemy(this.currentEnemy)},onCollisionExit:function(t,e){this.removeTarget(t.node),this.currentEnemy=this.getTarget()},removeTarget:function(t){this.targets=this.targets.filter(function(e){return e!==t})},getTarget:function(){return this.targets[0]},shoot:function(){if(this.currentEnemy){var t=cc.instantiate(this.bulletPrefab),e=this.node.convertToWorldSpaceAR(this.bulletPosition.position),n=this.node.parent.convertToNodeSpaceAR(e);t.position=cc.v2(n.x,n.y),t.angle=this.node.angle,t.getComponent("Bullet").configBullet(this.bulletData),this.node.parent.addChild(t),t.getComponent("Bullet").setVelocity(),i.instance.emit(s.PLAY_SFX,this.shootingSound)}},lookAtEnemy:function(t){var e=cc.v2(t.x,t.y),n=cc.v2(this.node.x,this.node.y),i=e.sub(n),s=Math.atan2(i.y,i.x),o=cc.misc.radiansToDegrees(s)-90;this.node.angle=o}}),cc._RF.pop()},{EventEmitter:"EventEmitter",Key:"Key",TowersData:"TowersData"}],UI:[function(t,e,n){"use strict";cc._RF.push(e,"d8cb9xE91JP/4NufbPnG6BL","UI");var i=t("MainEmitter"),s=t("EventCode").UI_EVENTS;cc.Class({extends:cc.Component,properties:{coinAmountLabel:cc.Label,waveAmountLabel:cc.Label,waveTimeoutLabel:cc.Label},onLoad:function(){this.coins=null,this.coinAmountLabel.string=this.coins,this.timer=10,i.instance.registerEvent(s.CREATE_WAVE,this.onCreateWave.bind(this)),i.instance.registerEvent(s.UPDATE_WAVE_COUNT,this.onUpdateWaveCount.bind(this)),i.instance.registerEvent(s.UPDATE_COINS_AMOUNT,this.onUpdateCoinsAmount.bind(this)),this.showWaveTimeout()},start:function(){},onCreateWave:function(){this.showWaveTimeout()},onUpdateWaveCount:function(t){this.waveAmountLabel.string="Wave "+t+"/10"},showWaveTimeout:function(){this.waveTimeoutLabel.string="Next wave in "+this.timer+"s",this.waveTimeoutLabel.node.active=!0,this.schedule(this.countDown,1)},countDown:function(){if(1===this.timer)return this.waveTimeoutLabel.node.active=!1,this.timer=10,void this.unschedule(this.countDown);this.timer--,this.waveTimeoutLabel.string="Next wave in "+this.timer+"s"},onUpdateCoinsAmount:function(t){this.coins=t,this.coinAmountLabel.string=this.coins}}),cc._RF.pop()},{EventCode:"EventCode",MainEmitter:"MainEmitter"}],WaveData:[function(t,e,n){"use strict";cc._RF.push(e,"a7829QRGOhD6oJxFHeM/lsF","WaveData"),cc.Class({extends:cc.Component,properties:{enemies:{default:[],type:[cc.Prefab]},enemiesCount:0,timeout:{default:10,serializable:!0},repeatInterval:1}}),cc._RF.pop()},{}]},{},["EventEmitter","Key","SingleTon","SettingController","GameManager","MenuManager","PopupSystem","SoundSystem","Base","Bullet","Enemy","EnemyWaves","Level","LevelMap","PanelCreate","PanelUpgrade","SoundManager","Tower","Towers","TowersData","UI","WaveData","EventCode","MainEmitter"]);